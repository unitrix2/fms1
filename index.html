<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Management Cell (CMC)</title>

    <script>
        const APP_CONFIG = {
            // STEP 1: Cloudflare Worker ka URL yahan paste karein (deploy karne ke baad)
            API_URL: "https://fms1.clickworld.workers.dev",
            
            // System Name
            ORG_NAME: "Contract Management Cell",
        };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Iridescence Background Animation */
        body {
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #141e30);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #ffffff;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glassmorphism Panel */
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* File Borders */
        .border-pink { border-left: 4px solid #ec4899; }
        .border-brown { border-left: 4px solid #a16207; }
        .border-white { border-left: 4px solid #e5e7eb; }

        /* Loader */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <aside class="w-64 glass-panel flex flex-col hidden md:flex z-20">
        <div class="p-6 text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-pink-500">
            CMC SYSTEM
        </div>
        <nav class="flex-1 px-4 space-y-2 mt-4">
            <button onclick="router('dashboard')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition">
                <i data-lucide="layout-dashboard"></i> Dashboard
            </button>
            <button onclick="router('files')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition">
                <i data-lucide="folder-open"></i> File Manager
            </button>
            <button onclick="router('admin')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition">
                <i data-lucide="settings"></i> Admin Panel
            </button>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col relative">
        
        <header class="h-16 glass-panel border-b border-white/10 flex items-center justify-between px-6">
            <h1 id="page-title" class="text-lg font-semibold">Dashboard</h1>
            
            <div class="relative w-96 group">
                <div class="absolute left-3 top-2.5 text-gray-400"><i data-lucide="search" class="w-4 h-4"></i></div>
                <input type="text" id="searchInput" placeholder="Search files, firms, contracts..." 
                       class="w-full bg-white/5 border border-white/10 rounded-full py-2 pl-10 pr-4 text-sm focus:outline-none focus:bg-white/10 transition">
            </div>
        </header>

        <div id="content-area" class="flex-1 overflow-y-auto p-6 relative">
            
            <div id="view-dashboard" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="text-gray-400 text-sm">Total Contracts</div>
                        <div class="text-3xl font-bold mt-2" id="stat-contracts">0</div>
                    </div>
                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="text-gray-400 text-sm">Active Files</div>
                        <div class="text-3xl font-bold mt-2" id="stat-files">0</div>
                    </div>
                    <div class="glass-panel p-6 rounded-2xl">
                        <div class="text-gray-400 text-sm">Pending Alerts</div>
                        <div class="text-3xl font-bold mt-2 text-yellow-400">3</div>
                    </div>
                </div>
            </div>

            <div id="view-files" class="hidden space-y-4">
                <div class="flex justify-between">
                    <h2 class="text-xl">File Repository</h2>
                    <button class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
                        <i data-lucide="plus"></i> Add New File
                    </button>
                </div>
                <div id="files-grid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center text-gray-400 py-10 w-full col-span-3">Loading Files...</div>
                </div>
            </div>

            <div id="view-admin" class="hidden">
                <div class="glass-panel p-6 rounded-xl">
                    <h2 class="text-xl mb-4">Admin Controls</h2>
                    <p class="text-gray-400">User Management and Logs will appear here.</p>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Init Icons
        lucide.createIcons();

        // Router
        function router(viewName) {
            // Hide all views
            ['dashboard', 'files', 'admin'].forEach(v => {
                document.getElementById('view-' + v).classList.add('hidden');
            });
            // Show selected view
            document.getElementById('view-' + viewName).classList.remove('hidden');
            document.getElementById('page-title').innerText = viewName.charAt(0).toUpperCase() + viewName.slice(1);
            
            if(viewName === 'dashboard') loadDashboard();
            if(viewName === 'files') loadFiles();
        }

        // Fetch Functions
        async function loadDashboard() {
            try {
                // Example Fetch
                // const res = await fetch(`${APP_CONFIG.API_URL}/api/dashboard`);
                // const data = await res.json();
                // Mock Data for UI Demo
                document.getElementById('stat-contracts').innerText = "124";
                document.getElementById('stat-files').innerText = "89";
            } catch (e) { console.error("API Error", e); }
        }

        async function loadFiles() {
            const grid = document.getElementById('files-grid');
            grid.innerHTML = '<div class="loader mx-auto"></div>'; // Show loader

            try {
                // Fetch actual data
                const res = await fetch(`${APP_CONFIG.API_URL}/api/dashboard`); // Using dashboard endpoint for demo list
                const data = await res.json();
                
                grid.innerHTML = ''; // Clear loader

                // Render Fake Items if DB empty, else Render Real Data
                // Demo rendering:
                const demoFiles = [
                    { name: "Pest Control Contract", no: "CMC/2024/001", type: "pink" },
                    { name: "Security Services", no: "CMC/2024/002", type: "brown" },
                    { name: "Housekeeping", no: "CMC/2024/003", type: "white" }
                ];

                demoFiles.forEach(file => {
                    const card = document.createElement('div');
                    card.className = `glass-panel p-4 rounded-xl border-${file.type} hover:bg-white/10 transition cursor-pointer`;
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold">${file.name}</h3>
                                <p class="text-xs text-gray-400 mt-1">${file.no}</p>
                            </div>
                            <i data-lucide="more-vertical" class="w-4 text-gray-400"></i>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <button class="text-xs bg-white/10 px-2 py-1 rounded hover:bg-blue-600 transition">View QR</button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
                lucide.createIcons();
            } catch (e) {
                grid.innerHTML = '<div class="text-red-400">Failed to load files. Check API Console.</div>';
            }
        }

        // Initialize
        router('dashboard');

        // Search Logic (Debounced)
        let timeout = null;
        document.getElementById('searchInput').addEventListener('input', function (e) {
            clearTimeout(timeout);
            timeout = setTimeout(function () {
                console.log("Searching for:", e.target.value);
                // Call API: fetch(`${APP_CONFIG.API_URL}/api/search?q=${e.target.value}`)
            }, 500);
        });

    </script>
</body>
</html>
